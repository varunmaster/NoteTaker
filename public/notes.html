<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Note Taker | Varun Master</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/4.1.3/flatly/bootstrap.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
</head>

<body>
    <nav class="navbar navbar-dark bg-dark">
        <a class="nav-link active" href="/">NoteTaker</a>
    </nav>
    <br>
    <br>
    <div class="container">
        <div class="jumbotron">
            <form>
                <div class="form-group">
                    <label for="exampleInputText">Title</label>
                    <input type="text" class="form-control" id="noteTitle" placeholder="Note Title">
                </div>
                <div class="form-group">
                    <label for="exampleFormControlTextarea1">Body</label>
                    <textarea class="form-control" id="noteBody" rows="3" placeholder="Body"></textarea>
                </div>
                <button type="submit" class="btn btn-primary text-right" id="submitBtn">Submit</button>
            </form>
        </div>
    </div>
    <div class="container">
        <div id="savedNotes">
        </div>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">
getAllNotes();
function getAllNotes() {
    $.get("/allNotes", (data) => {
        for (var i = 0; i < data.length; i++) {
            var cardDiv = $("<div class='card del'>");
            var cardBody = $("<div class='card-body'>");
            var title = $("<h5 class='card-title'>");
            var created = $("<h6 class='card-subtitle mb-2 text-muted'>");
            var para = $("<p class='card-text'>");
            var deleteBtn = $("<button type='submit' id='deleteBtn'>")
            var deleteIcon = $("<i class='fa fa-trash float-right'>");
            cardDiv.attr("data-id", data[i].id);
            deleteBtn.append(deleteIcon);
            cardDiv.append(deleteBtn);

            title.text(data[i].title);
            created.text(data[i].created_at);
            para.text(data[i].body);

            cardBody.append(title).append(created).append(para);
            cardDiv.append(cardBody);
            $("#savedNotes").prepend(cardDiv);
        }

    });
}

$("#savedNotes").on("click", "#deleteBtn", function () {
    console.log($(this).parents().eq(0).attr("data-id"));
    var id = $(this).parents().eq(0).attr("data-id");

    $.ajax("/notes/delete/" + id, {
        type: "DELETE"
    }).then(
        function (data) {
            console.log("deleted id ", id);
            // Reload the page to get the updated list
            //getAllNotes();
            if (data) {
                location.reload(true);
                getAllNotes();
            }
        }
    );
});

$("#submitBtn").on("click", (e) => {
    e.preventDefault();
    var newNote =
    {
        title: $("#noteTitle").val().trim(),
        body: $("#noteBody").val().trim()
    };

    $.post("/notes/add", newNote).then((data) => {
        if (data) {
            console.log(data);
            alert("Added note!");
            $("#noteTitle").val('');
            $("#noteBody").val('');
            location.reload(true);
            getAllNotes();
        } else {
            console.log("")
        }
    })
});
</script>

</html>